"use strict";(self.webpackChunkaggregation_pipeline_workshop=self.webpackChunkaggregation_pipeline_workshop||[]).push([[306],{4137:(e,n,t)=>{t.d(n,{Zo:()=>g,kt:()=>d});var r=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var p=r.createContext({}),s=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},g=function(e){var n=s(e.components);return r.createElement(p.Provider,{value:n},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,p=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),u=s(t),m=i,d=u["".concat(p,".").concat(m)]||u[m]||c[m]||o;return t?r.createElement(d,a(a({ref:n},g),{},{components:t})):r.createElement(d,a({ref:n},g))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,a=new Array(o);a[0]=m;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l[u]="string"==typeof e?e:i,a[1]=l;for(var s=2;s<o;s++)a[s]=t[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},733:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var r=t(7462),i=(t(7294),t(4137));const o={},a="Writing long pipelines",l={unversionedId:"simple-queries/writing-long-pipelines",id:"simple-queries/writing-long-pipelines",title:"Writing long pipelines",description:"Aggregation pipelines can get very long, depending on how many stages we need to run. Writing a pipeline is writing code, as you will write it using one of the many MongoDB drivers in your own language. Here we're presenting the examples using JavaScript suitable for the MongoDB Shell mongosh, but if you are writing a microservice in Rust, you'll definitely write your pipelines in Rust.",source:"@site/docs/30-simple-queries/6-writing-long-pipelines.mdx",sourceDirName:"30-simple-queries",slug:"/simple-queries/writing-long-pipelines",permalink:"/aggregation-workshop/docs/simple-queries/writing-long-pipelines",draft:!1,editUrl:"https://github.com/mongodb-developer/aggregation-workshop/blob/main/docs/30-simple-queries/6-writing-long-pipelines.mdx",tags:[],version:"current",sidebarPosition:6,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Combining stages",permalink:"/aggregation-workshop/docs/simple-queries/combining-them-all"},next:{title:"Counting and Sorting",permalink:"/aggregation-workshop/docs/category/counting-and-sorting"}},p={},s=[],g={toc:s},u="wrapper";function c(e){let{components:n,...t}=e;return(0,i.kt)(u,(0,r.Z)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"writing-long-pipelines"},"Writing long pipelines"),(0,i.kt)("p",null,"Aggregation pipelines can get very long, depending on how many stages we need to run. Writing a pipeline is writing code, as you will write it using one of the many MongoDB drivers in your own language. Here we're presenting the examples using JavaScript suitable for the MongoDB Shell ",(0,i.kt)("a",{parentName:"p",href:"https://www.mongodb.com/docs/mongodb-shell/"},"mongosh"),", but if you are writing a microservice in Rust, you'll definitely write your pipelines in Rust."),(0,i.kt)("p",null,"This is why we should rewrite our last pipeline like this:"),(0,i.kt)("p",null,"Get 15 books from 1991 with 150 pages. Show only the ",(0,i.kt)("inlineCode",{parentName:"p"},"title"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"year"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"totalInventory")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"available")," books. (Sample doc ",(0,i.kt)("a",{parentName:"p",href:"/docs/simple-queries/project"},"here"),")"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"db.books.aggregate([\n    {$match: {year: 1991, pages: 150}}, {$project: {_id: 0, title: 1, year: 1, totalInventory: 1, available: 1}}, {$limit: 15}\n])\n")),(0,i.kt)("p",null,"Will be changed into:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"let booksFrom1991With150pages = {$match: {year: 1991, pages: 150}};\nlet showOnlyTheseFields = {$project: {_id: 0, title: 1, year: 1, totalInventory: 1, available: 1}};\nlet getJust15books =  {$limit: 10};\n\ndb.books.aggregate([\n    booksFrom1991With150pages,\n    showOnlyTheseFields,\n    getJust15books,\n]);\n")),(0,i.kt)("p",null,"Easier to read, and reason about, right?"),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Write your aggregation pipelines like you'll compose functions in your programming language. Aggregations ",(0,i.kt)("em",{parentName:"p"},"are")," code that runs on the server. In the client you just express ",(0,i.kt)("em",{parentName:"p"},"what")," you want to be done, not ",(0,i.kt)("em",{parentName:"p"},"how")," to do it.")))}c.isMDXComponent=!0}}]);