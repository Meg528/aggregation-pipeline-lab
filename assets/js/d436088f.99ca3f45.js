"use strict";(self.webpackChunkaggregation_pipeline_workshop=self.webpackChunkaggregation_pipeline_workshop||[]).push([[187],{6471:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>o,metadata:()=>r,toc:()=>g});var i=n(5893),a=n(1151);const o={},s="\ud83e\uddb8\u200d\u2642\ufe0f Repeating stages",r={id:"simple-queries/repeating-stages",title:"\ud83e\uddb8\u200d\u2642\ufe0f Repeating stages",description:"Extra activity, do it if you have extra time or are following at home, won't be covered during the hands-on Lab",source:"@site/docs/30-simple-queries/7-repeating-stages.mdx",sourceDirName:"30-simple-queries",slug:"/simple-queries/repeating-stages",permalink:"/aggregation-pipeline-lab/docs/simple-queries/repeating-stages",draft:!1,unlisted:!1,editUrl:"https://github.com/mongodb-developer/aggregation-pipeline-lab/blob/main/docs/30-simple-queries/7-repeating-stages.mdx",tags:[],version:"current",sidebarPosition:7,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Writing long pipelines",permalink:"/aggregation-pipeline-lab/docs/simple-queries/writing-long-pipelines"},next:{title:"\ud83e\uddb8\u200d\u2642\ufe0f Aggregation options",permalink:"/aggregation-pipeline-lab/docs/simple-queries/aggregation-options"}},l={},g=[];function p(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",p:"p",pre:"pre",...(0,a.a)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"\ufe0f-repeating-stages",children:"\ud83e\uddb8\u200d\u2642\ufe0f Repeating stages"}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsx)(t.p,{children:"Extra activity, do it if you have extra time or are following at home, won't be covered during the hands-on Lab"})}),"\n",(0,i.jsxs)(t.p,{children:["From the ",(0,i.jsx)(t.a,{href:"https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/#stages",children:"Aggregation Pipelines manual"}),"."]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"All stages except the $out, $merge, $geoNear, $changeStream, and $changeStreamSplitLargeEvent stages can appear multiple times in a pipeline."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"So we can repeat most stages, and do something like this to get all books from 1985 with more than 100 pages (although it can make sense or not)"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"db.books.aggregate([{$match: {pages: {$gte: 100}}}, {$match: {year: 1985}}])\n"})}),"\n",(0,i.jsxs)(t.p,{children:["\ud83d\udcbb Add several ",(0,i.jsx)(t.code,{children:"$limt"})," stages at the end of the above aggregation, limiting to 1 book and see what happens"]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Answer"}),(0,i.jsx)("div",{children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"db.books.aggregate([\n    {$match: {pages: {$gte: 100}}}, \n    {$match: {year: 2011}},\n    {$limit: 1},\n    {$limit: 1},\n])\n"})})})]})]})}function c(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>r,a:()=>s});var i=n(7294);const a={},o=i.createContext(a);function s(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);